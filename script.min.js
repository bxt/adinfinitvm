(function(){var t,e,i,s,n,r,o,h,a,u,l,c,d,p,f,g,y,m=function(t,e){function i(){this.constructor=t}for(var s in e)v.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},v={}.hasOwnProperty,z=function(t,e){return function(){return t.apply(e,arguments)}},S=[].slice;d=function(){function t(t){this.id=t}return t.prototype.setId=function(t){return this.id=t,this},t.prototype.rotate=function(t){var e;return e=this.id>>4-t|this.id<<t&15,this.setId(e)},t.prototype.getQuad=function(t){return this.id>>t&1},t.prototype.setQuad=function(t){return this.id|=1<<t,this},t.prototype.unsetQuad=function(t){return this.id&=~(1<<t),this},t.prototype.clone=function(){return new t(this.id)},t.prototype.checkMatch=function(t,e){var i;return i=t.clone().rotate(2),this.getQuad(e)===i.getQuad(e)},t}(),p=function(){function t(t,e){this.size=t,this.width=e,this.halfSize=this.size/2,this.circleRadius=7*this.size/32,this.loadDesigns()}return t.prototype.setSquare=function(t){return this.square=t,this},t.prototype.addTo=function(t){return t.innerHTML=this.designs[this.square.id]},t.prototype.loadDesigns=function(){var t;return this.designs=function(){var e,i;for(i=[],t=e=0;e<16;t=++e)i.push(""+t);return i}()},t.prototype.layout=function(t){return'<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="'+this.size+'"\n  height="'+this.size+'"\n  viewBox="0 0 '+this.size+" "+this.size+'">\n  '+t+"\n</svg>"},t}(),g=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return m(e,t),e.prototype.loadDesigns=function(){var t,i,s,n,r,o;for(e.__super__.loadDesigns.call(this),this.paths={1:"M0 0 L"+this.halfSize+" "+this.halfSize+" L"+this.size+" 0 Z",2:"M"+this.size+" 0 L"+this.halfSize+" "+this.halfSize+" L"+this.size+" "+this.size+" Z",4:"M"+this.size+" "+this.size+" L"+this.halfSize+" "+this.halfSize+" L0 "+this.size+" Z",8:"M0 "+this.size+" L"+this.halfSize+" "+this.halfSize+" L0 0 Z"},o=[],t=i=0;i<16;t=++i)r=function(){var e,i;e=this.paths,i=[];for(s in e)n=e[s],(t&s)>0&&i.push('<path d="'+n+'" '+this.style()+" />");return i}.call(this),o.push(this.designs[t]=this.layout(r.join("paths")));return o},e.prototype.style=function(t){return'class="filled"'},e}(p),l=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return m(e,t),e.prototype.loadDesigns=function(){return e.__super__.loadDesigns.call(this),this.loadPaths(),this.load0Designs(),this.load1Designs(),this.load2Designs(),this.load3Designs(),this.load4Designs()},e.prototype.loadPaths=function(){return this.paths={1:"M"+this.halfSize+"        0 L"+this.halfSize+" "+(this.halfSize-this.circleRadius),2:"M"+this.size+" "+this.halfSize+" L"+(this.halfSize+this.circleRadius)+" "+this.halfSize,4:"M"+this.halfSize+" "+this.size+" L"+this.halfSize+" "+(this.halfSize+this.circleRadius),8:"M       0 "+this.halfSize+" L"+(this.halfSize-this.circleRadius)+" "+this.halfSize,5:"M"+this.halfSize+" 0 L"+this.halfSize+" "+this.size,10:"M0 "+this.halfSize+" L"+this.size+" "+this.halfSize,3:"M"+this.halfSize+"        0 A "+this.halfSize+" "+this.halfSize+" 0 0 0 "+this.size+" "+this.halfSize,6:"M"+this.halfSize+" "+this.size+" A "+this.halfSize+" "+this.halfSize+" 0 0 1 "+this.size+" "+this.halfSize,9:"M"+this.halfSize+"        0 A "+this.halfSize+" "+this.halfSize+" 0 0 1        0 "+this.halfSize,12:"M"+this.halfSize+" "+this.size+" A "+this.halfSize+" "+this.halfSize+" 0 0 0        0 "+this.halfSize}},e.prototype.load0Designs=function(){return this.designs[0]=this.layout("")},e.prototype.load1Designs=function(){var t,e,i,s,n;for(s=[1,2,4,8],n=[],e=0,i=s.length;e<i;e++)t=s[e],n.push(this.designs[t]=this.layout('<path d="'+this.paths[t]+'" '+this.styleWhite()+' />\n<circle cx="'+this.halfSize+'" cy="'+this.halfSize+'" r="'+this.circleRadius+'" '+this.styleWhite()+' />\n<path d="'+this.paths[t]+'" '+this.style()+' />\n<circle cx="'+this.halfSize+'" cy="'+this.halfSize+'" r="'+this.circleRadius+'" '+this.style()+" />"));return n},e.prototype.load2Designs=function(){var t,e,i,s,n;for(s=[5,10,3,6,9,12],n=[],e=0,i=s.length;e<i;e++)t=s[e],n.push(this.designs[t]=this.layout('<path d="'+this.paths[t]+'" '+this.styleWhite()+' />\n<path d="'+this.paths[t]+'" '+this.style()+" />"));return n},e.prototype.load3Designs=function(){var t,e,i,s,n,r,o;for(r=[7,11,13,14],o=[],e=0,s=r.length;e<s;e++)t=r[e],n=function(){var e,s,n,r;for(n=[3,6,9,12],r=[],e=0,s=n.length;e<s;e++)i=n[e],t&i^i||r.push('<path d="'+this.paths[i]+'" '+this.styleWhite()+' />\n<path d="'+this.paths[i]+'" '+this.style()+" />");return r}.call(this),o.push(this.designs[t]=this.layout(n.join("")));return o},e.prototype.load4Designs=function(){var t,e,i,s;return i=function(){var t,i,s,n;for(s=[3,6,12,9],n=[],t=0,i=s.length;t<i;t++)e=s[t],n.push('<path d="'+this.paths[e]+'" '+this.styleWhite()+' />\n<path d="'+this.paths[e]+'" '+this.style()+" />");return n}.call(this),s=this.halfSize*Math.PI/4,t='<path d="'+this.paths[3]+'" '+this.styleWhite("stroke-dasharray: "+(s-1)+"px, "+(s+1)+"px;")+'/>\n<path d="'+this.paths[3]+'" '+this.style("stroke-dasharray: "+s+"px;")+"/>",this.designs[15]=this.layout(i.join("")+t)},e.prototype.style=function(t){return'class="foreground" style="fill: none; stroke-width: '+this.width+"px; "+t+'"'},e.prototype.styleWhite=function(t){return'class="background" style="fill: none; stroke-width: '+8*this.width/6+"px; "+t+'"'},e}(p),e=function(){function t(t){this.dom=document.createElement(t)}return t.prototype.add=function(t){return t.addTo(this.dom)},t.prototype.addTo=function(t){return t.appendChild(this.dom)},t.prototype.remove=function(){return this.dom.parentNode.removeChild(this.dom)},t}(),t=function(t){function e(t){null==t&&(t=!0),this.clickHandler=z(this.clickHandler,this),e.__super__.constructor.call(this,"a"),this.dom.href="javascript:;",this.dom.addEventListener("click",this.clickHandler,!t)}return m(e,t),e.prototype.clickHandler=function(t){return this.clicked(t)},e}(e),f=function(t){function e(t,i){this.square=t,this.squareDesigns=i,this.clicked=z(this.clicked,this),e.__super__.constructor.call(this),this.refreshDom()}return m(e,t),e.prototype.freeze=function(){return this.frozen=!0},e.prototype.changeSquareDesigns=function(t){return this.squareDesigns=t,this.refreshDom()},e.prototype.clicked=function(t){if(!this.frozen)return this.square.rotate(1),this.refreshDom(),this.dom.style.transform="rotate(-90deg)",this.dom.offsetHeight,this.dom.classList.add("transitioning"),this.dom.style.transform="rotate(0deg)"},e.prototype.refreshDom=function(){return this.add(this.squareDesigns.setSquare(this.square)),this.dom.className="grid-square",this.dom.classList.add("grid-square-"+this.square.id)},e}(t),i=[[0,-1],[1,0],[0,1],[-1,0]],s=function(){function t(t,e,i){this.w=t,this.h=e,this.gridParts=i}return t.prototype.getAt=function(t,e){var i;return(null!=(i=this.gridParts[e])?i[t]:void 0)||new d(0)},t.prototype.getAtToQuad=function(t,e,s){var n;return n=i[s],this.getAt(t+n[0],e+n[1])},t.prototype.checkAll=function(){var t,e,i,s,n,r,o,h,a;for(h=t=0,n=this.w;0<=n?t<n:t>n;h=0<=n?++t:--t)for(a=e=0,r=this.h;0<=r?e<r:e>r;a=0<=r?++e:--e)for(o=this.getAt(h,a),s=i=0;i<4;s=++i)if(!o.checkMatch(this.getAtToQuad(h,a,s),s))return!1;return!0},t}(),n=function(t){function e(t){this.grid=t,this.isDone=z(this.isDone,this),this.designIndex=1*localStorage.getItem("adinfinitvm.designIndex"),e.__super__.constructor.call(this,"div"),this.dom.classList.add("grid"),this.initializeGrid(),this.dom.addEventListener("keydown",this.keydown)}var i;return m(e,t),i=[new l(40,6),new g(40,6)],e.prototype.initializeGrid=function(){var t,e,i,s,n,r,o,h;for(this.squareViews=[],this.dom.innerHTML="",h=t=0,i=this.grid.h;0<=i?t<i:t>i;h=0<=i?++t:--t){for(n=document.createElement("div"),n.classList.add("grid-row"),o=e=0,s=this.grid.w;0<=s?e<s:e>s;o=0<=s?++e:--e)r=new f(this.grid.getAt(o,h),this.squareDesigns()),this.squareViews.push(r),r.addTo(n);this.dom.appendChild(n)}},e.prototype.freeze=function(){var t,e,i,s,n;for(i=this.squareViews,s=[],t=0,e=i.length;t<e;t++)n=i[t],s.push(n.freeze());return s},e.prototype.changeSquareDesigns=function(){var t,e,s,n,r;for(this.designIndex=(this.designIndex+1)%i.length,localStorage.setItem("adinfinitvm.designIndex",this.designIndex),s=this.squareViews,n=[],t=0,e=s.length;t<e;t++)r=s[t],n.push(r.changeSquareDesigns(this.squareDesigns()));return n},e.prototype.squareDesigns=function(){return i[this.designIndex]},e.prototype.isDone=function(){return this.grid.checkAll()},e.prototype.keydown=function(t){var e,i,s;return null!=(i=function(){try{switch(t.keyCode){case 37:return document.activeElement.previousSibling||document.activeElement.parentNode.previousSibling.lastChild;case 38:for(s=document.activeElement.parentNode.previousSibling.firstChild,e=document.activeElement.previousSibling;e;)e=e.previousSibling,s=s.nextSibling;return s;case 39:return document.activeElement.nextSibling||document.activeElement.parentNode.nextSibling.firstChild;case 40:for(s=document.activeElement.parentNode.nextSibling.firstChild,e=document.activeElement.previousSibling;e;)e=e.previousSibling,s=s.nextSibling;return s}}catch(i){}}())?i.focus():void 0},e}(e),a=function(){function t(){}var e,i,n,r,o,h;return t.prototype.get=function(t){return e[t]||h(this.generateLevel(t))},t.prototype.generateLevel=function(t){var e,s,n,r,h,a,u;switch(n=o(t+1),r=n(),!1){case!(t<20):u=[3,3],s=[5,7];break;case!(t<50):u=[6,7],s=[6,7];break;case!(t<100):u=[6,7],s=[6,8];break;case!(t<200):u=[7,12],s=[7,9];break;default:u=[9,15],s=[9,9]}return e=.5,a=function(){switch(!1){case!(t<20):return.1;case!(t<30):return.9;default:return Math.min(10/t,.05)}}(),h=n()<a,i(u,s,e,h,n)},i=function(t,e,i,s,o){var h,a,u,l,c,d,p,f,g,y,m,v,z,w,k;for(null==o&&(o=Math.random),s&&(i/=2),z=r.apply(null,S.call(t).concat([o])),l=r.apply(null,S.call(e).concat([o])),u=n(z,l,function(){var t,e,i;for(i=[],w=t=0,e=z*l;0<=e?t<e:t>e;w=0<=e?++t:--t)i.push(0);return i}()),w=c=0,m=z;0<=m?c<m:c>m;w=0<=m?++c:--c)for(k=d=0,v=l;0<=v?d<v:d>v;k=0<=v?++d:--d)for(y=[],w!==z-1&&y.push(1),k!==l-1&&y.push(2),f=0,p=y.length;f<p;f++)g=y[f],o()<i&&(a=g+2&3,u.getAt(w,k).setQuad(g),u.getAtToQuad(w,k,g).setQuad(a),s&&(h=z-w-1,1===g?(u.getAt(h,k).setQuad(a),u.getAtToQuad(h,k,a).setQuad(g)):(u.getAt(h,k).setQuad(g),u.getAtToQuad(h,k,g).setQuad(a))));return u},o=function(t){return function(){return t=1e6*Math.sin(t),t-Math.floor(t)}},r=function(t,e,i){return null==i&&(i=Math.random),Math.floor(i()*(e-t)+t)},n=function(t,e,i){var n,r,o,h;return n=function(){var s,n,r;for(r=[],h=s=0,n=e;0<=n?s<n:s>n;h=0<=n?++s:--s)r.push(function(){var e,s,n;for(n=[],o=e=0,s=t;0<=s?e<s:e>s;o=0<=s?++e:--e)n.push(new d(i[o+h*t]));return n}());return r}(),r=new s(t,e,n)},h=function(t){var e,i,s,n,o,h;for(o=e=0,s=t.w;0<=s?e<s:e>s;o=0<=s?++e:--e)for(h=i=0,n=t.h;0<=n?i<n:i>n;h=0<=n?++i:--i)t.getAt(o,h).rotate(r(0,4));return t},e={0:n(2,1,[1,8]),1:n(2,2,[1,12,0,1]),2:n(3,2,[6,14,12,3,14,9]),3:n(4,2,[9,12,6,12,3,9,3,6]),4:h(n(3,2,[1,10,2,8,5,4])),5:n(3,3,[9,11,3,13,15,7,12,14,6]),6:h(n(4,5,[0,6,12,0,0,5,5,0,0,5,5,0,6,13,7,12,3,9,3,9])),7:h(n(3,3,[0,0,4,2,12,5,0,3,9])),8:n(6,4,[0,6,6,6,6,0,6,6,6,6,6,6,6,6,6,6,6,6,0,6,6,6,6,0]),9:h(n(4,4,[6,10,14,12,7,14,13,5,5,7,11,13,3,11,10,9])),10:h(n(6,4,[0,6,12,6,12,0,0,5,7,13,5,0,0,3,13,7,9,0,2,8,3,9,2,8])),13:h(n(4,5,[0,6,12,0,4,7,13,4,3,13,7,9,6,11,11,12,3,10,10,9])),15:h(n(5,5,[6,10,14,14,12,7,10,13,5,5,7,14,15,11,13,5,5,7,10,13,3,11,11,10,9])),19:h(n(6,6,[0,0,6,12,0,0,0,4,5,7,8,0,6,11,15,15,10,12,3,10,15,15,14,9,0,2,13,5,1,0,0,0,3,9,0,0])),21:h(n(6,6,[0,0,6,12,0,0,0,4,7,13,4,0,6,11,15,15,11,12,3,14,15,15,14,9,0,1,7,13,1,0,0,0,3,9,0,0])),25:h(n(7,6,[0,0,6,10,10,10,12,6,10,11,12,0,0,5,5,6,12,5,6,12,5,5,3,9,5,3,9,5,5,0,0,3,14,10,9,3,10,10,10,9,0,0])),28:h(n(8,5,[0,0,0,6,12,0,0,0,0,0,6,11,11,12,0,0,0,6,11,10,10,11,12,0,6,11,10,10,10,10,11,12,3,10,10,10,10,10,10,9])),33:h(n(8,6,[4,4,6,10,10,10,10,12,5,5,5,6,10,10,12,5,5,5,5,1,2,12,5,5,5,5,3,8,4,5,5,5,5,3,10,10,9,5,5,5,3,10,10,10,10,9,1,1])),42:h(n(6,5,[4,0,4,6,10,12,5,0,5,1,0,5,3,10,13,6,10,9,0,0,5,5,0,4,0,0,1,3,10,9])),100:h(n(5,3,[4,6,12,6,12,5,5,5,5,5,1,3,9,3,9]))},t}(),h=function(){function t(t,e){this.time=t,this.callback=e}return t.prototype.isRunning=function(){return null!=this.dom},t.prototype.start=function(){return this.dom=window.setInterval(this.callback,this.time)},t.prototype.stop=function(){return window.clearInterval(this.dom),this.dom=null},t.prototype.toggle=function(){return this.isRunning()?this.stop():this.start()},t}(),c=function(t){function e(t){this.grid=t,this.ticked=z(this.ticked,this),this.clicked=z(this.clicked,this),this.interval=new h(50,this.ticked),e.__super__.constructor.call(this),this.dom.innerHTML="?",this.dom.className="button solver",this.counter=0}return m(e,t),e.prototype.clicked=function(t){return this.interval.toggle()},e.prototype.ticked=function(){var t,e,i,s,n,r,o,h;for(console.log("solver tick"),n=this.pad(this.counter.toString(4)),this.counter=this.counter+1,s=this.pad(this.counter.toString(4)),r=this.squares(),o=[],t=e=0,i=r.length;e<i;t=++e)h=r[t],n[t]!==s[t]?o.push(h.click()):o.push(void 0);return o},e.prototype.pad=function(t){for(;t.length<this.squares().length;)t="0"+t;return t},e.prototype.squares=function(){return document.getElementsByClassName("grid-square")},e}(t),o=function(){function t(){this.dom=document.getElementById("instructions")}var e;return e=function(t){return"— "+t+" —"},t.prototype.start=function(t){return this.setMessage(this.startMessage(t))},t.prototype.end=function(t){return this.setMessage(this.endMessage(t))},t.prototype.setMessage=function(t){if(null!=t)return this.dom.innerHTML=t},t.prototype.startMessage=function(t){switch(t){case 0:return null;case 1:return e("try this one");case 2:return e("looks nice right? click to bottom center piece to create two rings");case 3:return e("there may be multiple loops like in this example");case 4:return"(the game is called ADINFINITVM, okay?)";case 5:return e("let's see how far you can get");case 7:return"(hint: there's an alternate mode, hit the ♦ in the bottom right corner)";default:return"&nbsp;"}},t.prototype.endMessage=function(t){switch(t){case 0:return e("now click anywhere to start the next level");case 10:return e("#10 already, keep up the good work!");case 50:return e("oh nice! #50");case 1337:return e("#1337 — 11100010 10011101 10100100");default:return(""+t).match(/^[15]0+$/)?this.tweetMessage(t):e("#"+t)}},t.prototype.tweetMessage=function(t){var i,s;return s="I've just completed level "+t+" in @amoebe's #adinfinitvm game! https://bxt.github.io/adinfinitvm/",i="http://twitter.com/home?status="+encodeURIComponent(s),e("congratulations! you have completed #"+t+'.\n<a class="button" href="'+i+'" target="_blank">tweet</a>')},t}(),r=function(){function t(){this.dom=document.getElementsByTagName("h2")[0]}return t.prototype.hide=function(){return window.setTimeout(function(t){return function(){return t.dom.style.height=t.dom.clientHeight+"px",t.dom.offsetHeight,t.dom.style.height=0}}(this),1e3)},t}(),u=function(e){function i(){this.loadLevel=z(this.loadLevel,this),this.clicked=z(this.clicked,this),i.__super__.constructor.call(this,"div"),this.dom.classList.add("main"),document.addEventListener("click",this.clicked),this.levels=new a,this.level=1*localStorage.getItem("adinfinitvm.level"),this.instructions=new o,this.header=new r,this.createDesignChanger(),this.solver=new c,this.add(this.solver),this.loadLevel()}var s;return m(i,e),s="done",i.prototype.createDesignChanger=function(){return this.designChanger=new t,this.designChanger.clicked=function(t){return function(e){return e.stopPropagation(),t.gridView.changeSquareDesigns()}}(this),this.designChanger.dom.innerHTML="♦",this.designChanger.dom.className="button designChanger",this.add(this.designChanger)},i.prototype.clicked=function(){var t;if(this.gridView.isDone())return t=document.body.classList,t.contains(s)?(t.remove("done"),this.level=this.level+1,this.loadLevel()):(t.add("done"),this.gridView.freeze(),this.instructions.end(this.level),this.persistLevelProgress())},i.prototype.loadLevel=function(){var t,e;if(null!=(e=this.gridView)&&e.remove(),t=this.levels.get(this.level),this.gridView=new n(t),this.add(this.gridView),this.instructions.start(this.level),this.level>=4)return this.header.hide()},i.prototype.persistLevelProgress=function(){var t;if(t=localStorage.getItem("adinfinitvm.level"),this.level>=t)return localStorage.setItem("adinfinitvm.level",this.level+1)},i}(e),y=new u,y.addTo(document.getElementById("jscontainer"))}).call(this);